# Vision Model Training Configuration

# Paths Configuration
paths:
  data_path: "../../DataPipeline/data/preprocessed"
  output_path: "../data"
  
# Training Configuration
training:
  epochs: 50
  batch_size: 32
  image_size: [224, 224]
  validation_split: 0.2
  datasets:
    - "tb"
    - "lung_cancer_ct_scan"

# Data Augmentation Configuration
data_augmentation:
  rotation_range: 20
  width_shift_range: 0.2
  height_shift_range: 0.2
  horizontal_flip: true
  zoom_range: 0.2
  fill_mode: "nearest"

# Model Architectures Configuration
models:
  # ResNet50 Configuration
  resnet50:
    weights: null  # No pre-trained weights - full training from scratch
    include_top: false
    trainable: true  # Full training - all layers trainable
    head:
      dropout_1: 0.5
      dense_1: 512
      dropout_2: 0.3
      activation: "relu"
    learning_rate: 0.001
  
  # Custom CNN Configuration
  cnn_custom:
    conv_blocks:
      - filters: 32
        kernel_size: [3, 3]
        dropout: 0.25
      - filters: 64
        kernel_size: [3, 3]
        dropout: 0.25
      - filters: 128
        kernel_size: [3, 3]
        dropout: 0.25
      - filters: 256
        kernel_size: [3, 3]
        dropout: 0.25
    dense_layers:
      - units: 512
        dropout: 0.5
      - units: 256
        dropout: 0.3
    learning_rate: 0.001
  
  # Vision Transformer (ViT-Small) Configuration
  vit:
    patch_size: 16
    projection_dim: 384  # ViT-Small hidden size
    num_heads: 6  # ViT-Small number of heads
    transformer_layers: 12  # ViT-Small depth
    mlp_ratio: 4  # MLP size = projection_dim * mlp_ratio
    attention_dropout: 0.1
    mlp_dropout: 0.1
    mlp_head_units: [1024, 512]
    mlp_head_dropout: 0.5
    learning_rate: 0.001

# Training Callbacks Configuration
callbacks:
  model_checkpoint:
    monitor: "val_accuracy"
    save_best_only: true
    mode: "max"
    verbose: 1
  
  early_stopping:
    monitor: "val_accuracy"
    patience: 10
    restore_best_weights: true
    verbose: 1
  
  reduce_lr:
    monitor: "val_loss"
    factor: 0.5
    patience: 5
    min_lr: 0.0000001
    verbose: 1

# Model Selection Configuration
model_selection:
  metric: "test_accuracy"  # Metric to use for selecting best model

# Hyperparameter Tuning Configuration
hyperparameter_tuning:
  enabled: false  # Set to true to enable hyperparameter tuning
  tuner_type: "random"  # Options: "random", "bayesian", "hyperband"
  max_trials: 10  # Maximum number of trials to run
  executions_per_trial: 1  # Number of times to train each model
  objective: "val_accuracy"  # Metric to optimize
  direction: "max"  # "max" for accuracy, "min" for loss
  directory: "../data/hyperparameter_tuning"  # Directory to save tuning results
  project_name: "vision_model_tuning"
  
  # Hyperparameter search space
  search_space:
    learning_rate:
      min: 0.0001
      max: 0.01
      step: 0.0001
    batch_size:
      values: [16, 32, 64]
    dropout_rate:
      min: 0.2
      max: 0.6
      step: 0.1
    
    # ResNet50 specific
    resnet50:
      dense_units:
        values: [256, 512, 1024]
      dropout_1:
        min: 0.3
        max: 0.6
        step: 0.1
      dropout_2:
        min: 0.2
        max: 0.5
        step: 0.1
    
    # CNN Custom specific
    cnn_custom:
      conv_filters_multiplier:
        values: [1.0, 1.5, 2.0]
      dense_units_1:
        values: [256, 512, 1024]
      dense_units_2:
        values: [128, 256, 512]
    
    # ViT specific
    vit:
      projection_dim:
        values: [256, 384, 512]
      num_heads:
        values: [4, 6, 8]
      transformer_layers:
        values: [8, 12, 16]
      mlp_head_units_1:
        values: [512, 1024, 2048]
      mlp_head_units_2:
        values: [256, 512, 1024]

# MLflow Configuration
mlflow:
  tracking_uri: null  # Will be set to file:///{output_path}/mlruns
  experiment_name_prefix: null  # Will be set to {dataset_name}_model_training

# Logging Configuration
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# Deployment Configuration
deployment:
  # Validation thresholds
  min_accuracy: 0.70
  min_f1_score: 0.65
  
  # Bias detection thresholds
  max_accuracy_disparity: 0.10
  max_f1_disparity: 0.10
  
  # Vertex AI configuration
  vertex_ai:
    region: "us-central1"
    serving_container: "us-docker.pkg.dev/vertex-ai/prediction/tf2-cpu.2-13:latest"
    machine_type: "n1-standard-4"
    min_replicas: 1
    max_replicas: 3
  
  # Monitoring configuration
  monitoring:
    check_interval_hours: 24
    alert_on_accuracy_drop: true
    alert_on_bias_detected: true